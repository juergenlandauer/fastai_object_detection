---

title: FasterRCNN


keywords: fastai
sidebar: home_sidebar

summary: "FasterRCNN for object detection. "
description: "FasterRCNN for object detection. "
nb_path: "notebooks/04a_models.fasterrcnn.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks/04a_models.fasterrcnn.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/user/jupyter/env/lib/python3.7/site-packages/torch/cuda/__init__.py:52: UserWarning: CUDA initialization: Found no NVIDIA driver on your system. Please check that you have an NVIDIA GPU and installed a driver from http://www.nvidia.com/Download/index.aspx (Triggered internally at  /pytorch/c10/cuda/CUDAFunctions.cpp:100.)
  return torch._C._cuda_getDeviceCount() &gt; 0
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://arxiv.org/abs/1506.01497">FasterRCNN paper</a> - <a href="https://github.com/pytorch/vision/blob/master/torchvision/models/detection/faster_rcnn.py">Implementation</a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Functions-to-create-the-model">Functions to create the model<a class="anchor-link" href="#Functions-to-create-the-model"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_fasterrcnn_model" class="doc_header"><code>get_fasterrcnn_model</code><a href="https://github.com/rbrtwlz/fastai_object_detection/tree/master/fastai_object_detection/models/fasterrcnn.py#L38" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_fasterrcnn_model</code>(<strong><code>arch_str</code></strong>, <strong><code>num_classes</code></strong>, <strong><code>pretrained</code></strong>=<em><code>True</code></em>, <strong><code>pretrained_backbone</code></strong>=<em><code>True</code></em>, <strong><code>trainable_layers</code></strong>=<em><code>5</code></em>, <strong><code>min_size</code></strong>=<em><code>800</code></em>, <strong><code>max_size</code></strong>=<em><code>1333</code></em>, <strong><code>image_mean</code></strong>=<em><code>None</code></em>, <strong><code>image_std</code></strong>=<em><code>None</code></em>, <strong><code>rpn_anchor_generator</code></strong>=<em><code>None</code></em>, <strong><code>rpn_head</code></strong>=<em><code>None</code></em>, <strong><code>rpn_pre_nms_top_n_train</code></strong>=<em><code>2000</code></em>, <strong><code>rpn_pre_nms_top_n_test</code></strong>=<em><code>1000</code></em>, <strong><code>rpn_post_nms_top_n_train</code></strong>=<em><code>2000</code></em>, <strong><code>rpn_post_nms_top_n_test</code></strong>=<em><code>1000</code></em>, <strong><code>rpn_nms_thresh</code></strong>=<em><code>0.7</code></em>, <strong><code>rpn_fg_iou_thresh</code></strong>=<em><code>0.7</code></em>, <strong><code>rpn_bg_iou_thresh</code></strong>=<em><code>0.3</code></em>, <strong><code>rpn_batch_size_per_image</code></strong>=<em><code>256</code></em>, <strong><code>rpn_positive_fraction</code></strong>=<em><code>0.5</code></em>, <strong><code>box_roi_pool</code></strong>=<em><code>None</code></em>, <strong><code>box_head</code></strong>=<em><code>None</code></em>, <strong><code>box_predictor</code></strong>=<em><code>None</code></em>, <strong><code>box_score_thresh</code></strong>=<em><code>0.05</code></em>, <strong><code>box_nms_thresh</code></strong>=<em><code>0.5</code></em>, <strong><code>box_detections_per_img</code></strong>=<em><code>100</code></em>, <strong><code>box_fg_iou_thresh</code></strong>=<em><code>0.5</code></em>, <strong><code>box_bg_iou_thresh</code></strong>=<em><code>0.5</code></em>, <strong><code>box_batch_size_per_image</code></strong>=<em><code>512</code></em>, <strong><code>box_positive_fraction</code></strong>=<em><code>0.25</code></em>, <strong><code>bbox_reg_weights</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Creates FasterRCNN model with resnet backbone</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_fasterrcnn_model_swin" class="doc_header"><code>get_fasterrcnn_model_swin</code><a href="https://github.com/rbrtwlz/fastai_object_detection/tree/master/fastai_object_detection/models/fasterrcnn.py#L89" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_fasterrcnn_model_swin</code>(<strong><code>arch_str</code></strong>, <strong><code>num_classes</code></strong>, <strong><code>pretrained</code></strong>=<em><code>False</code></em>, <strong><code>pretrained_backbone</code></strong>=<em><code>True</code></em>, <strong><code>min_size</code></strong>=<em><code>800</code></em>, <strong><code>max_size</code></strong>=<em><code>1333</code></em>, <strong><code>image_mean</code></strong>=<em><code>None</code></em>, <strong><code>image_std</code></strong>=<em><code>None</code></em>, <strong><code>rpn_anchor_generator</code></strong>=<em><code>None</code></em>, <strong><code>rpn_head</code></strong>=<em><code>None</code></em>, <strong><code>rpn_pre_nms_top_n_train</code></strong>=<em><code>2000</code></em>, <strong><code>rpn_pre_nms_top_n_test</code></strong>=<em><code>1000</code></em>, <strong><code>rpn_post_nms_top_n_train</code></strong>=<em><code>2000</code></em>, <strong><code>rpn_post_nms_top_n_test</code></strong>=<em><code>1000</code></em>, <strong><code>rpn_nms_thresh</code></strong>=<em><code>0.7</code></em>, <strong><code>rpn_fg_iou_thresh</code></strong>=<em><code>0.7</code></em>, <strong><code>rpn_bg_iou_thresh</code></strong>=<em><code>0.3</code></em>, <strong><code>rpn_batch_size_per_image</code></strong>=<em><code>256</code></em>, <strong><code>rpn_positive_fraction</code></strong>=<em><code>0.5</code></em>, <strong><code>box_roi_pool</code></strong>=<em><code>None</code></em>, <strong><code>box_head</code></strong>=<em><code>None</code></em>, <strong><code>box_predictor</code></strong>=<em><code>None</code></em>, <strong><code>box_score_thresh</code></strong>=<em><code>0.05</code></em>, <strong><code>box_nms_thresh</code></strong>=<em><code>0.5</code></em>, <strong><code>box_detections_per_img</code></strong>=<em><code>100</code></em>, <strong><code>box_fg_iou_thresh</code></strong>=<em><code>0.5</code></em>, <strong><code>box_bg_iou_thresh</code></strong>=<em><code>0.5</code></em>, <strong><code>box_batch_size_per_image</code></strong>=<em><code>512</code></em>, <strong><code>box_positive_fraction</code></strong>=<em><code>0.25</code></em>, <strong><code>bbox_reg_weights</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Creates FasterRCNN model with swin transformer backbone</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Custom-FasterRCNN">Custom FasterRCNN<a class="anchor-link" href="#Custom-FasterRCNN"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To create a model, which you can pass to a <a href="/fastai_object_detection/learners.html#ObjDetLearner"><code>ObjDetLearner</code></a> simply create a <code>partial</code> with the functions <a href="/fastai_object_detection/models.fasterrcnn.html#get_fasterrcnn_model"><code>get_fasterrcnn_model</code></a> (resnet backbone) or <a href="/fastai_object_detection/models.fasterrcnn.html#get_fasterrcnn_model_swin"><code>get_fasterrcnn_model_swin</code></a> (swin transformer backbone).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="n">custom_fasterrcnn</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">get_fasterrcnn_model</span><span class="p">,</span> <span class="n">arch_str</span><span class="o">=</span><span class="s2">&quot;resnet18&quot;</span><span class="p">,</span> 
                            <span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pretrained_backbone</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                            <span class="n">min_size</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When building the <code>Learner</code>, the number of classes are getting passed to this partial function and the model is ready for training.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">custom_fasterrcnn</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>No pretrained coco model found for fasterrcnn_resnet18
This does not affect the backbone.
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>FasterRCNN(
  (transform): GeneralizedRCNNTransform(
      Normalize(mean=[0.0, 0.0, 0.0], std=[1.0, 1.0, 1.0])
      Resize(min_size=(600,), max_size=600, mode=&#39;bilinear&#39;)
  )
  (backbone): BackboneWithFPN(
    (body): IntermediateLayerGetter(
      (conv1): Conv2d(3, 64, kernel_size=(7, 7), stride=(2, 2), padding=(3, 3), bias=False)
      (bn1): FrozenBatchNorm2d(64)
      (relu): ReLU(inplace=True)
      (maxpool): MaxPool2d(kernel_size=3, stride=2, padding=1, dilation=1, ceil_mode=False)
      (layer1): Sequential(
        (0): BasicBlock(
          (conv1): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
          (bn1): FrozenBatchNorm2d(64)
          (relu): ReLU(inplace=True)
          (conv2): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
          (bn2): FrozenBatchNorm2d(64)
        )
        (1): BasicBlock(
          (conv1): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
          (bn1): FrozenBatchNorm2d(64)
          (relu): ReLU(inplace=True)
          (conv2): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
          (bn2): FrozenBatchNorm2d(64)
        )
      )
      (layer2): Sequential(
        (0): BasicBlock(
          (conv1): Conv2d(64, 128, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1), bias=False)
          (bn1): FrozenBatchNorm2d(128)
          (relu): ReLU(inplace=True)
          (conv2): Conv2d(128, 128, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
          (bn2): FrozenBatchNorm2d(128)
          (downsample): Sequential(
            (0): Conv2d(64, 128, kernel_size=(1, 1), stride=(2, 2), bias=False)
            (1): FrozenBatchNorm2d(128)
          )
        )
        (1): BasicBlock(
          (conv1): Conv2d(128, 128, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
          (bn1): FrozenBatchNorm2d(128)
          (relu): ReLU(inplace=True)
          (conv2): Conv2d(128, 128, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
          (bn2): FrozenBatchNorm2d(128)
        )
      )
      (layer3): Sequential(
        (0): BasicBlock(
          (conv1): Conv2d(128, 256, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1), bias=False)
          (bn1): FrozenBatchNorm2d(256)
          (relu): ReLU(inplace=True)
          (conv2): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
          (bn2): FrozenBatchNorm2d(256)
          (downsample): Sequential(
            (0): Conv2d(128, 256, kernel_size=(1, 1), stride=(2, 2), bias=False)
            (1): FrozenBatchNorm2d(256)
          )
        )
        (1): BasicBlock(
          (conv1): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
          (bn1): FrozenBatchNorm2d(256)
          (relu): ReLU(inplace=True)
          (conv2): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
          (bn2): FrozenBatchNorm2d(256)
        )
      )
      (layer4): Sequential(
        (0): BasicBlock(
          (conv1): Conv2d(256, 512, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1), bias=False)
          (bn1): FrozenBatchNorm2d(512)
          (relu): ReLU(inplace=True)
          (conv2): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
          (bn2): FrozenBatchNorm2d(512)
          (downsample): Sequential(
            (0): Conv2d(256, 512, kernel_size=(1, 1), stride=(2, 2), bias=False)
            (1): FrozenBatchNorm2d(512)
          )
        )
        (1): BasicBlock(
          (conv1): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
          (bn1): FrozenBatchNorm2d(512)
          (relu): ReLU(inplace=True)
          (conv2): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
          (bn2): FrozenBatchNorm2d(512)
        )
      )
    )
    (fpn): FeaturePyramidNetwork(
      (inner_blocks): ModuleList(
        (0): Conv2d(64, 256, kernel_size=(1, 1), stride=(1, 1))
        (1): Conv2d(128, 256, kernel_size=(1, 1), stride=(1, 1))
        (2): Conv2d(256, 256, kernel_size=(1, 1), stride=(1, 1))
        (3): Conv2d(512, 256, kernel_size=(1, 1), stride=(1, 1))
      )
      (layer_blocks): ModuleList(
        (0): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
        (1): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
        (2): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
        (3): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
      )
      (extra_blocks): LastLevelMaxPool()
    )
  )
  (rpn): RegionProposalNetwork(
    (anchor_generator): AnchorGenerator()
    (head): RPNHead(
      (conv): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
      (cls_logits): Conv2d(256, 3, kernel_size=(1, 1), stride=(1, 1))
      (bbox_pred): Conv2d(256, 12, kernel_size=(1, 1), stride=(1, 1))
    )
  )
  (roi_heads): RoIHeads(
    (box_roi_pool): MultiScaleRoIAlign()
    (box_head): TwoMLPHead(
      (fc6): Linear(in_features=12544, out_features=1024, bias=True)
      (fc7): Linear(in_features=1024, out_features=1024, bias=True)
    )
    (box_predictor): FastRCNNPredictor(
      (cls_score): Linear(in_features=1024, out_features=5, bias=True)
      (bbox_pred): Linear(in_features=1024, out_features=20, bias=True)
    )
  )
)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Prebuilt-models">Prebuilt models<a class="anchor-link" href="#Prebuilt-models"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are some prebuilt model partials, which you can use instantly:</p>
<p>Resnet Backbone:</p>
<ul>
<li><a href="/fastai_object_detection/models.fasterrcnn.html#fasterrcnn_resnet18"><code>fasterrcnn_resnet18</code></a></li>
<li><a href="/fastai_object_detection/models.fasterrcnn.html#fasterrcnn_resnet34"><code>fasterrcnn_resnet34</code></a></li>
<li><a href="/fastai_object_detection/models.fasterrcnn.html#fasterrcnn_resnet50"><code>fasterrcnn_resnet50</code></a></li>
<li><a href="/fastai_object_detection/models.fasterrcnn.html#fasterrcnn_resnet101"><code>fasterrcnn_resnet101</code></a></li>
<li><a href="/fastai_object_detection/models.fasterrcnn.html#fasterrcnn_resnet152"><code>fasterrcnn_resnet152</code></a></li>
</ul>
<p>Swin Transformer Backbone:</p>
<ul>
<li><a href="/fastai_object_detection/models.fasterrcnn.html#fasterrcnn_swinT"><code>fasterrcnn_swinT</code></a> (tiny)</li>
<li><a href="/fastai_object_detection/models.fasterrcnn.html#fasterrcnn_swinS"><code>fasterrcnn_swinS</code></a> (small)</li>
<li><a href="/fastai_object_detection/models.fasterrcnn.html#fasterrcnn_swinB"><code>fasterrcnn_swinB</code></a> (base)</li>
<li><a href="/fastai_object_detection/models.fasterrcnn.html#fasterrcnn_swinL"><code>fasterrcnn_swinL</code></a> (large)</li>
</ul>

</div>
</div>
</div>
</div>
 

